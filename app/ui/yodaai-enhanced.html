<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YodaAI - Conversational 4Ls Retrospective Assistant</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            overflow-x: hidden;
            background: #0a0a0a;
        }

        /* Landing Page Styles */
        .landing-page {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            overflow: hidden;
        }

        .landing-page::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><defs><radialGradient id="a" cx="50%" cy="50%"><stop offset="0%" stop-color="%23ffffff" stop-opacity="0.1"/><stop offset="100%" stop-color="%23ffffff" stop-opacity="0"/></radialGradient></defs><circle cx="200" cy="200" r="300" fill="url(%23a)"/><circle cx="800" cy="300" r="200" fill="url(%23a)"/><circle cx="400" cy="700" r="250" fill="url(%23a)"/></svg>');
            opacity: 0.3;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            position: relative;
            z-index: 2;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            position: relative;
            z-index: 10;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 800;
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-outline {
            background: transparent;
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .btn-primary {
            background: white;
            color: #667eea;
        }

        .btn-primary:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        /* Hero Section */
        .hero {
            text-align: center;
            padding: 100px 0 80px;
            color: white;
        }

        .hero h1 {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 20px;
            line-height: 1.2;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .hero p {
            font-size: 1.3rem;
            margin-bottom: 40px;
            opacity: 0.9;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 60px;
        }

        .btn-large {
            padding: 18px 36px;
            font-size: 1.1rem;
            min-width: 200px;
        }

        .trial-info {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 20px;
        }

        /* Features Section */
        .features {
            background: white;
            padding: 100px 0;
        }

        .section-title {
            text-align: center;
            margin-bottom: 60px;
        }

        .section-title h2 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
        }

        .section-title p {
            font-size: 1.2rem;
            color: #666;
            max-width: 600px;
            margin: 0 auto;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 40px;
            margin-bottom: 80px;
        }

        .feature-card {
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #f0f0f0;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
        }

        .feature-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            margin-bottom: 20px;
        }

        .feature-card h3 {
            font-size: 1.4rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }

        .feature-card p {
            color: #666;
            line-height: 1.6;
        }

        /* Stats Section */
        .stats {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 80px 0;
            color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 40px;
            text-align: center;
        }

        .stat-item h3 {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 10px;
        }

        .stat-item p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* CTA Section */
        .cta {
            background: white;
            padding: 100px 0;
            text-align: center;
        }

        .cta h2 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 20px;
        }

        .cta p {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 40px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Footer */
        .footer {
            background: #333;
            color: white;
            padding: 40px 0;
            text-align: center;
        }

        /* Login Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 400px;
            width: 90%;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .modal h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-buttons {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }

        .form-buttons .btn {
            flex: 1;
            justify-content: center;
        }

        .google-btn {
            background: #4285f4;
            color: white;
            border: none;
            width: 100%;
            margin-top: 15px;
        }

        .google-btn:hover {
            background: #357ae8;
        }

        /* Dashboard Styles */
        .dashboard {
            display: none;
            min-height: 100vh;
            background: #0a0a0a;
            color: white;
        }

        .dashboard-header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            padding: 20px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .dashboard-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dashboard-logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
        }
        /* Thematic edit styles */
        .theme-card { position: relative; }
        .theme-card .drag-handle { display:none; position:absolute; left:-36px; top:12px; width:28px; height:28px; border-radius:6px; background:rgba(255,255,255,0.06); align-items:center; justify-content:center; cursor:grab; }
        .theme-card:hover .drag-handle { display:flex; }
        .theme-title[contenteditable] { outline: none; border-bottom:1px dashed rgba(255,255,255,0.08); padding-bottom:2px; }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .dashboard-content {
            padding: 40px 0;
        }

        .welcome-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 40px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .welcome-section h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: white;
            margin-bottom: 10px;
        }

        .welcome-section p {
            font-size: 1.2rem;
            color: #ccc;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .dashboard-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.08);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .icon-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .icon-success { background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%); }
        .icon-warning { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .icon-info { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: white;
        }

        .card-content {
            color: #ccc;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 250px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            height: calc(100vh - 80px);
            overflow-y: auto;
            position: fixed;
            left: 0;
            top: 80px;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            z-index: 50;
        }

        .sidebar.open {
            transform: translateX(0);
        }

        .sidebar-nav {
            list-style: none;
        }

        .sidebar-nav li {
            margin-bottom: 10px;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px 20px;
            text-decoration: none;
            color: #ccc;
            border-radius: 12px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .sidebar-nav a:hover, .sidebar-nav a.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .main-content {
            margin-left: 0;
            transition: margin-left 0.3s ease;
        }

        .main-content.sidebar-open {
            margin-left: 250px;
        }

        .menu-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #667eea;
        }

        /* Content Sections */
        .content-section {
            display: none;
            padding: 30px;
        }

        .content-section.active {
            display: block;
        }

        /* Onboarding Styles */
        .onboarding-step {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }

        .step-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            margin: 0 5px;
            transition: all 0.3s ease;
        }

        .step-dot.active {
            background: #667eea;
        }

        .step-dot.completed {
            background: #56ab2f;
        }

        /* Team Management */
        .team-form {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 15px;
            align-items: end;
        }

        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .team-member {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .member-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            color: white;
            font-weight: 600;
            font-size: 1.3rem;
        }

        .member-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: white;
        }

        .member-role {
            color: #ccc;
            font-size: 0.9rem;
        }

        /* Project Upload */
        .project-upload {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 40px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .upload-icon {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 15px;
        }

        .file-input {
            display: none;
        }

        .file-info {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            text-align: left;
        }

        /* Retrospective Chat */
        .retro-chat {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chat-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: white;
        }

        .chat-status {
            background: rgba(86, 171, 47, 0.2);
            color: #56ab2f;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .chat-messages {
            height: 400px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.3);
        }

        .message {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: flex-start;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .message.ai .message-avatar {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        }

        .message-content {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 20px;
            border-radius: 18px;
            max-width: 70%;
            line-height: 1.5;
            color: white;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-left: auto;
        }

        .chat-input {
            display: flex;
            gap: 15px;
        }

        .chat-input input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s ease;
            background: rgba(255, 255, 255, 0.05);
            color: white;
        }

        .chat-input input:focus {
            border-color: #667eea;
        }

        .chat-input input::placeholder {
            color: #ccc;
        }

        .send-btn {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .send-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        /* 4Ls Steps */
        .steps-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .step-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .step-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
        }

        .step-card.active {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .step-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            color: white;
            font-size: 1.5rem;
        }

        .step-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: white;
        }

        .step-description {
            color: #ccc;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* Action Items */
        .action-items {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .action-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .action-item:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .priority-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-high { background: rgba(198, 40, 40, 0.2); color: #c62828; }
        .priority-medium { background: rgba(239, 108, 0, 0.2); color: #ef6c00; }
        .priority-low { background: rgba(46, 125, 50, 0.2); color: #2e7d32; }

        /* Analytics */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .analytics-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .analytics-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 10px;
        }

        .analytics-label {
            color: #ccc;
            font-weight: 500;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .hero-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .features-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                width: 100%;
            }
            
            .main-content.sidebar-open {
                margin-left: 0;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Landing Page -->
    <div id="landingPage" class="landing-page">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <a href="#" class="logo">
                    <i class="fas fa-robot"></i>
                    YodaAI
                </a>
                <div class="nav-buttons">
                    <button class="btn btn-outline" onclick="showLoginModal()">Sign In</button>
                    <button class="btn btn-primary" onclick="showLoginModal()">Get Started</button>
                </div>
            </div>

            <!-- Visible Upload UI for Action Items (enabled) -->
            <div id="actionItemUpload" class="content-section">
                <h3 style="margin-bottom:12px; color: white;">Upload Document for Thematic Analysis</h3>
                <div class="project-upload" style="text-align:left;">
                    <div class="upload-area" id="actionUploadArea" onclick="document.getElementById('actionFileInput').click()" style="cursor:pointer;">
                        <i class="fas fa-file-upload upload-icon"></i>
                        <p style="color:#ccc; margin-top:8px;">Click or drop a text/markdown file here to upload for thematic analysis.</p>
                        <input id="actionFileInput" type="file" class="file-input" accept=".txt,.md,.json" />
                    </div>

                    <div style="display:flex; gap:10px; margin-top:12px;">
                        <button id="analyzeUploadBtn" class="btn btn-primary" onclick="analyzeUploadedFile()" disabled>Upload & Analyze</button>
                        <button class="btn btn-outline" onclick="clearActionUpload()">Clear</button>
                    </div>

                    <pre id="actionUploadResult" style="color:#ccc; margin-top:12px; display:none; white-space:pre-wrap; background: rgba(255,255,255,0.02); padding:12px; border-radius:8px; max-height:300px; overflow:auto;"></pre>
                </div>
            </div>

            <!--
            Thematic Analysis UI Hook (commented out)
            This block provides a way for users to supply a data upload path (or paste text)
            and trigger the OpenAI-backed thematic analysis endpoint. It's intentionally
            commented out until you're ready to enable integration.

            To enable: remove the surrounding comment markers and wire any required auth headers.
            -->
            <!--
            <div id="thematicAnalysisHook" class="content-section">
                <h2 style="margin-bottom: 20px; color: white;">Run Thematic Analysis</h2>

                <div style="margin-bottom: 12px;">
                    <label style="color:#ccc; font-weight:600; display:block; margin-bottom:8px;">Data upload path (e.g. gs://bucket/path or local/file.txt)</label>
                    <input id="dataUploadPath" type="text" class="form-group" placeholder="Enter data upload path or paste text here" style="width:100%; padding:12px 16px; border-radius:8px; border:1px solid rgba(255,255,255,0.08); background:transparent; color:white;" />
                </div>

                <div style="margin-bottom: 12px;">
                    <label style="color:#ccc; font-weight:600; display:block; margin-bottom:8px;">Or paste text for analysis</label>
                    <textarea id="thematicText" rows="6" placeholder="Paste text to analyze..." style="width:100%; padding:12px 16px; border-radius:8px; border:1px solid rgba(255,255,255,0.08); background:transparent; color:white;"></textarea>
                </div>

                <div style="display:flex; gap:12px;">
                    <button class="btn btn-primary" onclick="runThematicAnalysisFromUI()">Run Thematic Analysis</button>
                    <button class="btn btn-outline" onclick="() => { document.getElementById('dataUploadPath').value=''; document.getElementById('thematicText').value=''; }">Clear</button>
                </div>

                <div id="thematicResult" style="margin-top:16px; color:#ccc;"></div>

                <script>
                // Commented-out helper: call the server thematic analysis endpoint and show result
                async function runThematicAnalysisFromUI() {
                    // const path = document.getElementById('dataUploadPath').value;
                    const text = document.getElementById('thematicText').value;
                    if (!text) {
                        alert('Please provide text or a data path to analyze.');
                        return;
                    }

                    // Example fetch to the new thematic-analysis route
                    try {
                        const res = await fetch('/api/v1/ai-chat/thematic-analysis', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ text })
                        });

                        if (!res.ok) {
                            const err = await res.text();
                            document.getElementById('thematicResult').innerText = 'Error: ' + err;
                            return;
                        }

                        const data = await res.json();
                        document.getElementById('thematicResult').innerText = JSON.stringify(data.analysis, null, 2);
                    } catch (e) {
                        document.getElementById('thematicResult').innerText = 'Request failed: ' + e.message;
                    }
                }
                </script>
            </div>
            -->

            <!-- Hero Section -->
            <div class="hero">
                <h1>Your Complete AI-Powered Retrospective Assistant</h1>
                <p>Experience the power of AI-guided 4Ls retrospectives. Transform your team's agile practices with intelligent conversation, pattern recognition, and actionable insights.</p>
                
                <div class="hero-buttons">
                    <button class="btn btn-primary btn-large" onclick="showLoginModal()">
                        <i class="fas fa-rocket"></i>
                        Start Free Trial
                    </button>
                    <button class="btn btn-outline btn-large" onclick="showLoginModal()">
                        <i class="fas fa-sign-in-alt"></i>
                        Sign In
                    </button>
                </div>
                
                <div class="trial-info">
                    Free 14-day trial â€¢ No credit card required â€¢ Cancel anytime
                </div>
            </div>
        </div>
    </div>

    <!-- Features Section -->
    <div class="features">
        <div class="container">
            <div class="section-title">
                <h2>Complete AI Toolkit</h2>
                <p>Everything you need to conduct meaningful retrospectives with AI assistance in one comprehensive platform.</p>
            </div>

            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <h3>AI Chat Interface</h3>
                    <p>Chat with intelligent AI that guides you through the 4Ls framework. Get personalized prompts, follow-up questions, and real-time assistance during retrospectives.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h3>Team Management</h3>
                    <p>Manage multiple teams with role-based permissions. Add members, assign roles, and organize your agile teams with comprehensive collaboration tools.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <h3>Action Items Tracking</h3>
                    <p>Generate and track action items with AI assistance. Monitor progress, assign owners, and ensure follow-through on team improvements.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h3>Analytics & Insights</h3>
                    <p>Get detailed analytics about your retrospectives, team engagement, and improvement trends. Identify patterns and make data-driven decisions.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <h3>PDF Analysis</h3>
                    <p>Upload project documents and get AI-powered summaries. Extract insights from sprint reports, project plans, and team documentation.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h3>Enterprise Ready</h3>
                    <p>Built with enterprise-grade security, GDPR compliance, and advanced permission controls. Scale across multiple teams and organizations.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Section -->
    <div class="stats">
        <div class="container">
            <div class="stats-grid">
                <div class="stat-item">
                    <h3>50K+</h3>
                    <p>Active Users</p>
                </div>
                <div class="stat-item">
                    <h3>1M+</h3>
                    <p>Retrospectives Conducted</p>
                </div>
                <div class="stat-item">
                    <h3>99.9%</h3>
                    <p>Uptime</p>
                </div>
                <div class="stat-item">
                    <h3>24/7</h3>
                    <p>AI Support</p>
                </div>
            </div>
        </div>
    </div>

    <!-- CTA Section -->
    <div class="cta">
        <div class="container">
            <h2>Ready to Transform Your Retrospectives?</h2>
            <p>Join thousands of agile teams using YodaAI to supercharge their retrospective process with AI assistance.</p>
            <button class="btn btn-primary btn-large" onclick="showLoginModal()">
                <i class="fas fa-rocket"></i>
                Start Free Trial
            </button>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div class="container">
            <p>&copy; 2024 YodaAI. Conversational 4Ls Retrospective Assistant.</p>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeLoginModal()">&times;</button>
            <h2>Welcome to YodaAI</h2>
            
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" placeholder="your@email.com">
            </div>
            
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Your password">
            </div>
            
            <div class="form-group">
                <label for="role">Select Your Role</label>
                <select id="role">
                    <option value="">Choose your role...</option>
                    <option value="scrum-master">Scrum Master / Project Manager</option>
                    <option value="developer">Developer</option>
                    <option value="product-owner">Product Owner</option>
                    <option value="qa">QA Engineer</option>
                    <option value="designer">Designer</option>
                    <option value="devops">DevOps Engineer</option>
                </select>
            </div>
            
            <div class="form-buttons">
                <button class="btn btn-outline" onclick="signIn()">
                    <i class="fas fa-sign-in-alt"></i>
                    Sign In
                </button>
                <button class="btn btn-primary" onclick="signUp()">
                    <i class="fas fa-user-plus"></i>
                    Sign Up
                </button>
            </div>
            
            <button class="btn google-btn" onclick="signInWithGoogle()">
                <i class="fab fa-google"></i>
                Sign in with Google
            </button>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" style="background: none; color: #667eea; text-decoration: underline;" onclick="demoLogin()">
                    <i class="fas fa-play"></i>
                    Try Demo Mode
                </button>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard">
        <div class="dashboard-header">
            <div class="container">
                <div class="dashboard-nav">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <button class="menu-toggle" onclick="toggleSidebar()">
                            <i class="fas fa-bars"></i>
                        </button>
                        <div class="dashboard-logo">
                            <i class="fas fa-robot"></i>
                            YodaAI
                        </div>
                    </div>
                    <div class="user-info">
                        <div class="user-avatar" id="userAvatar">U</div>
                        <div>
                            <div id="userName" style="font-weight: 600; color: white;">User</div>
                            <div id="userEmail" style="color: #ccc; font-size: 0.9rem;">user@example.com</div>
                        </div>
                        <button class="btn btn-outline" onclick="logout()" style="margin-left: 15px;">
                            <i class="fas fa-sign-out-alt"></i>
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div id="sidebar" class="sidebar">
            <ul class="sidebar-nav">
                <li><a href="#" onclick="showSection('dashboard')" class="active">
                    <i class="fas fa-tachometer-alt"></i>
                    Dashboard
                </a></li>
                <li><a href="#" onclick="showSection('onboarding')">
                    <i class="fas fa-user-cog"></i>
                    Onboarding
                </a></li>
                <li><a href="#" onclick="showSection('teams')">
                    <i class="fas fa-users"></i>
                    Teams
                </a></li>
                <li><a href="#" onclick="showSection('retrospectives')">
                    <i class="fas fa-comments"></i>
                    Retrospectives
                </a></li>
                <li><a href="#" onclick="showSection('action-items')">
                    <i class="fas fa-tasks"></i>
                    Action Items
                </a></li>
                <li><a href="#" onclick="showSection('analytics')">
                    <i class="fas fa-chart-line"></i>
                    Analytics
                </a></li>
            </ul>
        </div>

        <!-- Main Content -->
        <div id="mainContent" class="main-content">
            <!-- Dashboard Section -->
            <div id="dashboardSection" class="content-section active">
                <div class="welcome-section">
                    <h1>Welcome back, <span id="welcomeName">User</span>! ðŸ‘‹</h1>
                    <p>Ready to conduct another insightful retrospective? Let's help your team reflect, learn, and improve together.</p>
                </div>

                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-icon icon-primary">
                                <i class="fas fa-plus"></i>
                            </div>
                            <div class="card-title">Start New Retrospective</div>
                        </div>
                        <div class="card-content">
                            Create a new 4Ls retrospective session with AI assistance. Set up your team and begin the structured conversation.
                        </div>
                        <button class="btn btn-primary" style="width: 100%;" onclick="startRetrospective()">
                            <i class="fas fa-rocket"></i>
                            Start Retrospective
                        </button>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-icon icon-success">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="card-title">Manage Teams</div>
                        </div>
                        <div class="card-content">
                            Add team members, assign roles, and manage your agile teams. Connect calendars and set up automated reminders.
                        </div>
                        <button class="btn btn-primary" style="width: 100%;" onclick="showSection('teams')">
                            <i class="fas fa-cog"></i>
                            Manage Teams
                        </button>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-icon icon-warning">
                                <i class="fas fa-tasks"></i>
                            </div>
                            <div class="card-title">Action Items</div>
                        </div>
                        <div class="card-content">
                            Track and manage action items from your retrospectives. Get AI-powered insights and automated follow-ups.
                        </div>
                        <button class="btn btn-primary" style="width: 100%;" onclick="showSection('action-items')">
                            <i class="fas fa-eye"></i>
                            View Actions
                        </button>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-icon icon-info">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <div class="card-title">Analytics & Insights</div>
                        </div>
                        <div class="card-content">
                            View detailed analytics about your retrospectives, team engagement, and improvement trends over time.
                        </div>
                        <button class="btn btn-primary" style="width: 100%;" onclick="showSection('analytics')">
                            <i class="fas fa-chart-line"></i>
                            View Analytics
                        </button>
                    </div>
                </div>
            </div>

            <!-- Onboarding Section -->
            <div id="onboardingSection" class="content-section">
                <h2 style="margin-bottom: 30px; color: white;">Onboarding Setup</h2>
                
                <div class="step-indicator">
                    <div class="step-dot active" id="step1"></div>
                    <div class="step-dot" id="step2"></div>
                    <div class="step-dot" id="step3"></div>
                    <div class="step-dot" id="step4"></div>
                </div>

                <!-- Step 1: Role Selection -->
                <div id="onboardingStep1" class="onboarding-step">
                    <h3 style="color: white; margin-bottom: 20px;">Step 1: Confirm Your Role</h3>
                    <p style="color: #ccc; margin-bottom: 30px;">Please confirm your role in the team. This will determine your permissions and responsibilities.</p>
                    
                    <div class="form-group">
                        <label for="confirmRole" style="color: white;">Your Role</label>
                        <select id="confirmRole" style="background: rgba(255, 255, 255, 0.05); color: white; border: 1px solid rgba(255, 255, 255, 0.1);">
                            <option value="">Select your role...</option>
                            <option value="scrum-master">Scrum Master / Project Manager</option>
                            <option value="developer">Developer</option>
                            <option value="product-owner">Product Owner</option>
                            <option value="qa">QA Engineer</option>
                            <option value="designer">Designer</option>
                            <option value="devops">DevOps Engineer</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-primary" onclick="nextOnboardingStep()" style="width: 100%;">
                        <i class="fas fa-arrow-right"></i>
                        Continue
                    </button>
                </div>

                <!-- Step 2: Calendar Connection -->
                <div id="onboardingStep2" class="onboarding-step" style="display: none;">
                    <h3 style="color: white; margin-bottom: 20px;">Step 2: Connect Calendar (Optional)</h3>
                    <p style="color: #ccc; margin-bottom: 30px;">Connect your work calendar to enable automated scheduling and reminders.</p>
                    
                    <div style="display: flex; gap: 15px; margin-bottom: 30px;">
                        <button class="btn btn-primary" style="flex: 1;" onclick="connectGoogleCalendar()">
                            <i class="fab fa-google"></i>
                            Connect Google Calendar
                        </button>
                        <button class="btn btn-outline" style="flex: 1;" onclick="connectOutlook()">
                            <i class="fab fa-microsoft"></i>
                            Connect Outlook
                        </button>
                    </div>
                    
                    <button class="btn btn-outline" onclick="skipCalendar()" style="width: 100%; margin-bottom: 15px;">
                        <i class="fas fa-skip-forward"></i>
                        Skip for Later
                    </button>
                    
                    <button class="btn btn-primary" onclick="nextOnboardingStep()" style="width: 100%;">
                        <i class="fas fa-arrow-right"></i>
                        Continue
                    </button>
                </div>

                <!-- Step 3: Team Setup (Scrum Master only) -->
                <div id="onboardingStep3" class="onboarding-step" style="display: none;">
                    <h3 style="color: white; margin-bottom: 20px;">Step 3: Team Setup</h3>
                    <p style="color: #ccc; margin-bottom: 30px;">As a Scrum Master, you can create a team and invite members. This step is optional and can be done later.</p>
                    
                    <div class="form-group">
                        <label for="teamName" style="color: white;">Team Name</label>
                        <input type="text" id="teamName" placeholder="Enter unique team name..." style="background: rgba(255, 255, 255, 0.05); color: white; border: 1px solid rgba(255, 255, 255, 0.1);">
                    </div>
                    
                    <div style="display: flex; gap: 15px;">
                        <button class="btn btn-primary" onclick="createTeam()" style="flex: 1;">
                            <i class="fas fa-plus"></i>
                            Create Team
                        </button>
                        <button class="btn btn-outline" onclick="skipTeamSetup()" style="flex: 1;">
                            <i class="fas fa-skip-forward"></i>
                            Skip for Later
                        </button>
                    </div>
                </div>

                <!-- Step 4: Project Upload -->
                <div id="onboardingStep4" class="onboarding-step" style="display: none;">
                    <h3 style="color: white; margin-bottom: 20px;">Step 4: Upload Project Documents</h3>
                    <p style="color: #ccc; margin-bottom: 30px;">Upload project documents to help YodaAI understand your team's context and provide better insights.</p>
                    
                    <div class="project-upload">
                        <div class="upload-area" onclick="document.getElementById('projectFileInput').click()">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <h3 style="color: white;">Upload Project Documents</h3>
                            <p style="color: #ccc;">Drag and drop PDF files here or click to browse</p>
                            <p style="font-size: 0.9rem; color: #666;">Supported formats: PDF, DOC, DOCX</p>
                        </div>
                        <input type="file" id="projectFileInput" class="file-input" accept=".pdf,.doc,.docx" onchange="handleProjectUpload(event)">
                        
                        <div id="projectFileInfo" class="file-info" style="display: none;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-weight: 600; color: white;" id="projectFileName"></div>
                                    <div style="font-size: 0.9rem; color: #ccc;" id="projectFileSize"></div>
                                </div>
                                <button class="btn btn-primary" onclick="analyzeProjectDocument()">
                                    <i class="fas fa-brain"></i>
                                    Analyze with AI
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-outline" onclick="skipProjectUpload()" style="width: 100%; margin-bottom: 15px;">
                        <i class="fas fa-skip-forward"></i>
                        Skip for Later
                    </button>
                    
                    <button class="btn btn-primary" onclick="completeOnboarding()" style="width: 100%;">
                        <i class="fas fa-check"></i>
                        Complete Setup
                    </button>
                </div>
            </div>

            <!-- Teams Section -->
            <div id="teamsSection" class="content-section">
                <h2 style="margin-bottom: 30px; color: white;">Team Management</h2>
                
                <div class="team-form">
                    <h3 style="color: white; margin-bottom: 20px;">Add Team Member</h3>
                    <div class="form-row">
                        <input type="text" id="memberName" placeholder="Full name" style="background: rgba(255, 255, 255, 0.05); color: white; border: 1px solid rgba(255, 255, 255, 0.1);">
                        <input type="email" id="memberEmail" placeholder="email@company.com" style="background: rgba(255, 255, 255, 0.05); color: white; border: 1px solid rgba(255, 255, 255, 0.1);">
                        <select id="memberRole" style="background: rgba(255, 255, 255, 0.05); color: white; border: 1px solid rgba(255, 255, 255, 0.1);">
                            <option value="developer">Developer</option>
                            <option value="scrum-master">Scrum Master</option>
                            <option value="product-owner">Product Owner</option>
                            <option value="qa">QA Engineer</option>
                            <option value="designer">Designer</option>
                            <option value="devops">DevOps</option>
                        </select>
                        <button class="btn btn-primary" onclick="addTeamMember()">
                            <i class="fas fa-plus"></i>
                            Add
                        </button>
                    </div>
                </div>

                <div class="team-grid" id="teamGrid">
                    <!-- Team members will be added here dynamically -->
                </div>
            </div>

            <!-- Retrospectives Section -->
            <div id="retrospectivesSection" class="content-section">
                <h2 style="margin-bottom: 30px; color: white;">4Ls Retrospective with YodaAI</h2>
                
                <div class="steps-container">
                    <div class="step-card active" data-step="liked">
                        <div class="step-icon">
                            <i class="fas fa-heart"></i>
                        </div>
                        <div class="step-title">Liked</div>
                        <div class="step-description">What did you like about this sprint?</div>
                    </div>
                    <div class="step-card" data-step="learned">
                        <div class="step-icon">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div class="step-title">Learned</div>
                        <div class="step-description">What did you learn?</div>
                    </div>
                    <div class="step-card" data-step="lacked">
                        <div class="step-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="step-title">Lacked</div>
                        <div class="step-description">What didn't go well?</div>
                    </div>
                    <div class="step-card" data-step="longed">
                        <div class="step-icon">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="step-title">Longed For</div>
                        <div class="step-description">What do you wish had happened?</div>
                    </div>
                </div>

                <div class="retro-chat">
                    <div class="chat-header">
                        <div class="chat-title">YodaAI Assistant</div>
                        <div class="chat-status">Active</div>
                    </div>
                    <div class="chat-messages" id="chatMessages">
                        <div class="message ai">
                            <div class="message-avatar">ðŸ¤–</div>
                            <div class="message-content">
                                Hi there! Welcome to your retrospective! I'm YodaAI, your AI assistant. Let's start with what you <strong>Liked</strong> about this sprint. What went well that you'd like to continue?
                            </div>
                        </div>
                    </div>
                    <div class="chat-input">
                        <input type="text" id="chatInput" placeholder="Type your response..." onkeypress="handleChatKeyPress(event)">
                        <button class="send-btn" onclick="sendMessage()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Action Items Section -->
            <div id="actionItemsSection" class="content-section">
                <h2 style="margin-bottom: 20px; color: white;">Action Items â€” Thematic Analysis Upload</h2>

                <div style="margin-bottom:12px; color:#ccc;">Upload a document and we'll run an OpenAI thematic analysis and group detected themes for review.</div>

                <div style="display:flex; gap:12px; align-items:center; margin-bottom:16px;">
                    <input id="actionFileOnlyInput" type="file" accept=".txt,.md,.json" style="display:inline-block;" />
                    <button id="actionAnalyzeBtn" class="btn btn-primary" onclick="analyzeActionFile()">Analyze File</button>
                    <button class="btn btn-outline" onclick="clearActionAnalysis()">Clear</button>
                </div>

                <div id="actionAnalysisStatus" style="color:#ccc; margin-bottom:12px;"></div>

                <div id="groupedThemesContainer" style="display:block;">
                    <!-- Themes will be rendered here -->
                </div>
            </div>

            <!-- Analytics Section -->
            <div id="analyticsSection" class="content-section">
                <h2 style="margin-bottom: 30px; color: white;">Analytics & Insights</h2>
                
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <div class="analytics-number">12</div>
                        <div class="analytics-label">Total Retrospectives</div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-number">3</div>
                        <div class="analytics-label">Active Sessions</div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-number">28</div>
                        <div class="analytics-label">Completed Actions</div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-number">85%</div>
                        <div class="analytics-label">Team Engagement</div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-icon icon-info">
                            <i class="fas fa-lightbulb"></i>
                        </div>
                        <div class="card-title">AI Insights</div>
                    </div>
                    <div class="card-content">
                        <p><strong>Pattern Recognition:</strong> Your team consistently identifies communication as a key challenge. Consider implementing daily standups or async updates.</p>
                        <p><strong>Success Factors:</strong> Code reviews and pair programming are frequently mentioned as positive practices. Continue these activities.</p>
                        <p><strong>Improvement Areas:</strong> Deployment process and vendor communication need attention based on recent feedback.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let currentStep = 'liked';
        let chatHistory = [];
        let uploadedFile = null;
        let currentOnboardingStep = 1;
        let teamMembers = [];
        let projectDocuments = [];
    // Prevent concurrent AI requests
    let awaitingResponse = false;

        // Authentication functions
        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'flex';
        }

        function closeLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
        }

        function signIn() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;
            
            if (!email || !password || !role) {
                alert('Please enter all required fields');
                return;
            }
            
            // Simulate successful login
            currentUser = {
                name: email.split('@')[0],
                email: email,
                displayName: email.split('@')[0].charAt(0).toUpperCase() + email.split('@')[0].slice(1),
                role: role
            };
            
            showDashboard();
        }

        function signUp() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;
            
            if (!email || !password || !role) {
                alert('Please enter all required fields');
                return;
            }
            
            if (password.length < 6) {
                alert('Password must be at least 6 characters long');
                return;
            }
            
            // Simulate successful signup
            currentUser = {
                name: email.split('@')[0],
                email: email,
                displayName: email.split('@')[0].charAt(0).toUpperCase() + email.split('@')[0].slice(1),
                role: role
            };
            
            showDashboard();
        }

        function signInWithGoogle() {
            // Simulate Google sign-in
            currentUser = {
                name: 'Google User',
                email: 'user@gmail.com',
                displayName: 'Google User',
                role: 'scrum-master'
            };
            
            showDashboard();
        }

        function demoLogin() {
            currentUser = {
                name: 'Demo User',
                email: 'demo@yodaai.com',
                displayName: 'Demo User',
                role: 'scrum-master'
            };
            
            showDashboard();
        }

        function showDashboard() {
            // Hide landing page completely
            document.getElementById('landingPage').style.display = 'none';
            // Hide features section
            document.querySelector('.features').style.display = 'none';
            document.querySelector('.stats').style.display = 'none';
            document.querySelector('.cta').style.display = 'none';
            document.querySelector('.footer').style.display = 'none';
            // Show dashboard
            document.getElementById('dashboard').style.display = 'block';
            // Hide modal
            document.getElementById('loginModal').style.display = 'none';
            
            // Update user info
            document.getElementById('userName').textContent = currentUser.displayName;
            document.getElementById('userEmail').textContent = currentUser.email;
            document.getElementById('userAvatar').textContent = currentUser.displayName.charAt(0).toUpperCase();
            document.getElementById('welcomeName').textContent = currentUser.displayName;
            
            // Ensure body doesn't have scroll issues
            document.body.style.overflow = 'auto';
        }

        function logout() {
            currentUser = null;
            document.getElementById('landingPage').style.display = 'block';
            document.getElementById('dashboard').style.display = 'none';
            // Show features section again
            document.querySelector('.features').style.display = 'block';
            document.querySelector('.stats').style.display = 'block';
            document.querySelector('.cta').style.display = 'block';
            document.querySelector('.footer').style.display = 'block';
            
            // Clear form
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
            document.getElementById('role').value = '';
        }

        // Navigation functions
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            
            sidebar.classList.toggle('open');
            mainContent.classList.toggle('sidebar-open');
        }

        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });

            // Remove active class from all nav links
            document.querySelectorAll('.sidebar-nav a').forEach(link => {
                link.classList.remove('active');
            });

            // Try to find the section element by a couple of naming conventions
            let sectionElem = document.getElementById(sectionName + 'Section');
            if (!sectionElem) {
                // Convert hyphenated-name to camelCase, e.g. action-items -> actionItems
                const camel = sectionName.replace(/-([a-z])/g, (m, c) => c.toUpperCase());
                sectionElem = document.getElementById(camel + 'Section');
            }

            if (sectionElem) {
                sectionElem.classList.add('active');
            } else {
                console.warn('showSection: could not find section for', sectionName);
            }

            // Add active class to selected nav link if present
            const navLink = document.querySelector(`[onclick="showSection('${sectionName}')"]`);
            if (navLink) navLink.classList.add('active');
        }

        // Onboarding functions
        function nextOnboardingStep() {
            if (currentOnboardingStep < 4) {
                currentOnboardingStep++;
                updateOnboardingSteps();
            }
        }

        function updateOnboardingSteps() {
            // Hide all steps
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`onboardingStep${i}`).style.display = 'none';
                document.getElementById(`step${i}`).classList.remove('active', 'completed');
            }
            
            // Show current step
            document.getElementById(`onboardingStep${currentOnboardingStep}`).style.display = 'block';
            document.getElementById(`step${currentOnboardingStep}`).classList.add('active');
            
            // Mark previous steps as completed
            for (let i = 1; i < currentOnboardingStep; i++) {
                document.getElementById(`step${i}`).classList.add('completed');
            }
        }

        function connectGoogleCalendar() {
            // Simulate Google Calendar OAuth flow
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Connecting...';
            btn.disabled = true;
            
            setTimeout(() => {
                btn.innerHTML = '<i class="fas fa-check"></i> Connected';
                btn.style.background = 'rgba(86, 171, 47, 0.2)';
                btn.style.color = '#56ab2f';
                btn.style.borderColor = '#56ab2f';
                
                // Show success message
                const successMsg = document.createElement('div');
                successMsg.style.cssText = `
                    background: rgba(86, 171, 47, 0.1);
                    border: 1px solid rgba(86, 171, 47, 0.3);
                    border-radius: 8px;
                    padding: 15px;
                    margin-top: 15px;
                    color: #56ab2f;
                    font-size: 0.9rem;
                `;
                successMsg.innerHTML = '<i class="fas fa-check-circle"></i> Google Calendar connected successfully! Retrospective reminders will be automatically scheduled.';
                
                btn.parentNode.insertBefore(successMsg, btn.parentNode.lastElementChild);
                
                alert('Google Calendar connected successfully! You will now receive automated retrospective reminders.');
            }, 2000);
        }

        function connectOutlook() {
            // Simulate Outlook OAuth flow
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Connecting...';
            btn.disabled = true;
            
            setTimeout(() => {
                btn.innerHTML = '<i class="fas fa-check"></i> Connected';
                btn.style.background = 'rgba(86, 171, 47, 0.2)';
                btn.style.color = '#56ab2f';
                btn.style.borderColor = '#56ab2f';
                
                // Show success message
                const successMsg = document.createElement('div');
                successMsg.style.cssText = `
                    background: rgba(86, 171, 47, 0.1);
                    border: 1px solid rgba(86, 171, 47, 0.3);
                    border-radius: 8px;
                    padding: 15px;
                    margin-top: 15px;
                    color: #56ab2f;
                    font-size: 0.9rem;
                `;
                successMsg.innerHTML = '<i class="fas fa-check-circle"></i> Outlook connected successfully! Team meetings will be automatically scheduled.';
                
                btn.parentNode.insertBefore(successMsg, btn.parentNode.lastElementChild);
                
                alert('Outlook connected successfully! Team meetings will be automatically scheduled.');
            }, 2000);
        }

        function skipCalendar() {
            nextOnboardingStep();
        }

        function createTeam() {
            const teamName = document.getElementById('teamName').value;
            if (!teamName) {
                alert('Please enter a team name');
                return;
            }
            
            alert(`Team "${teamName}" created successfully!`);
            nextOnboardingStep();
        }

        function skipTeamSetup() {
            nextOnboardingStep();
        }

        function handleProjectUpload(event) {
            const file = event.target.files[0];
            if (file) {
                uploadedFile = file;
                const fileInfo = document.getElementById('projectFileInfo');
                const fileName = document.getElementById('projectFileName');
                const fileSize = document.getElementById('projectFileSize');
                
                fileName.textContent = file.name;
                fileSize.textContent = `${(file.size / 1024 / 1024).toFixed(2)} MB`;
                fileInfo.style.display = 'block';
            }
        }

        function analyzeProjectDocument() {
            if (!uploadedFile) {
                alert('Please upload a file first');
                return;
            }
            
            // Show loading state
            const analyzeBtn = document.querySelector('.btn-primary');
            const originalText = analyzeBtn.innerHTML;
            analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing...';
            analyzeBtn.disabled = true;
            
            // Simulate AI analysis with realistic delay
            setTimeout(() => {
                // Generate AI summary based on document type
                const fileName = uploadedFile.name.toLowerCase();
                let summary = '';
                
                if (fileName.includes('police') || fileName.includes('management')) {
                    summary = `
                        <div style="background: rgba(86, 171, 47, 0.1); border: 1px solid rgba(86, 171, 47, 0.3); border-radius: 12px; padding: 20px; margin-top: 15px;">
                            <h4 style="color: #56ab2f; margin-bottom: 15px;"><i class="fas fa-brain"></i> AI Analysis Summary</h4>
                            <div style="color: #ccc; line-height: 1.6;">
                                <p><strong>Document Overview:</strong> This police management document outlines key operational procedures and administrative frameworks for law enforcement agencies. The document covers essential protocols for daily operations, resource allocation, and personnel management.</p>
                                
                                <p><strong>Key Themes Identified:</strong> The analysis reveals three primary focus areas: operational efficiency through standardized procedures, effective communication protocols between departments, and comprehensive training requirements for personnel. These themes suggest opportunities for process optimization and enhanced coordination.</p>
                                
                                <p><strong>Retrospective Insights:</strong> For agile teams working on similar projects, this document highlights the importance of clear communication channels, standardized workflows, and continuous training. The structured approach to management can inform sprint planning and team coordination strategies.</p>
                            </div>
                        </div>
                    `;
                } else if (fileName.includes('project') || fileName.includes('plan')) {
                    summary = `
                        <div style="background: rgba(86, 171, 47, 0.1); border: 1px solid rgba(86, 171, 47, 0.3); border-radius: 12px; padding: 20px; margin-top: 15px;">
                            <h4 style="color: #56ab2f; margin-bottom: 15px;"><i class="fas fa-brain"></i> AI Analysis Summary</h4>
                            <div style="color: #ccc; line-height: 1.6;">
                                <p><strong>Project Scope:</strong> This document defines the project's objectives, deliverables, and key milestones. It outlines the technical requirements, resource needs, and timeline expectations for successful project completion.</p>
                                
                                <p><strong>Risk Assessment:</strong> The analysis identifies potential challenges including scope creep, resource constraints, and timeline dependencies. These insights can help teams anticipate and mitigate risks during sprint planning and execution.</p>
                                
                                <p><strong>Team Alignment:</strong> The document emphasizes the importance of clear role definitions, communication protocols, and regular progress reviews. These elements are crucial for maintaining team cohesion and ensuring project success.</p>
                            </div>
                        </div>
                    `;
                } else {
                    summary = `
                        <div style="background: rgba(86, 171, 47, 0.1); border: 1px solid rgba(86, 171, 47, 0.3); border-radius: 12px; padding: 20px; margin-top: 15px;">
                            <h4 style="color: #56ab2f; margin-bottom: 15px;"><i class="fas fa-brain"></i> AI Analysis Summary</h4>
                            <div style="color: #ccc; line-height: 1.6;">
                                <p><strong>Document Analysis:</strong> The uploaded document has been processed and analyzed for key themes, objectives, and actionable insights. The AI has identified patterns and relationships that can inform team discussions and decision-making processes.</p>
                                
                                <p><strong>Key Insights:</strong> Based on the content analysis, several important themes emerge including process optimization opportunities, communication enhancement needs, and strategic alignment requirements. These insights will help guide more focused and productive retrospective discussions.</p>
                                
                                <p><strong>Application to Retrospectives:</strong> The document context will enable YodaAI to provide more relevant prompts, suggest appropriate discussion topics, and help identify patterns that may not be immediately obvious to team members during sprint retrospectives.</p>
                            </div>
                        </div>
                    `;
                }
                
                // Add summary to the file info section
                const fileInfo = document.getElementById('projectFileInfo');
                if (!fileInfo.querySelector('.ai-summary')) {
                    fileInfo.insertAdjacentHTML('beforeend', summary);
                }
                
                // Restore button state
                analyzeBtn.innerHTML = originalText;
                analyzeBtn.disabled = false;
                
                alert('Document analyzed successfully! YodaAI now has context about your project.');
                projectDocuments.push(uploadedFile);
            }, 2000 + Math.random() * 1000); // 2-3 second delay for realistic feel
        }

        function skipProjectUpload() {
            completeOnboarding();
        }

        function completeOnboarding() {
            alert('Onboarding completed! You can now start using YodaAI.');
            showSection('dashboard');
        }

        // Team management functions
        function addTeamMember() {
            const name = document.getElementById('memberName').value;
            const email = document.getElementById('memberEmail').value;
            const role = document.getElementById('memberRole').value;
            
            if (!name || !email) {
                alert('Please fill in all required fields');
                return;
            }
            
            // Add to team members array
            const member = {
                name: name,
                email: email,
                role: role
            };
            teamMembers.push(member);
            
            // Add to team grid
            const teamGrid = document.getElementById('teamGrid');
            const memberDiv = document.createElement('div');
            memberDiv.className = 'team-member';
            memberDiv.innerHTML = `
                <div class="member-avatar">${name.charAt(0).toUpperCase()}</div>
                <div class="member-name">${name}</div>
                <div class="member-role">${role.replace('-', ' ').toUpperCase()}</div>
            `;
            teamGrid.appendChild(memberDiv);
            
            // Clear form
            document.getElementById('memberName').value = '';
            document.getElementById('memberEmail').value = '';
            document.getElementById('memberRole').value = 'developer';
            
            alert('Team member added successfully!');
        }

        // Retrospective functions
        function startRetrospective() {
            // Check if user is in a team
            if (teamMembers.length === 0) {
                alert('You must be part of a team to start a retrospective. Please complete team setup first.');
                showSection('teams');
                return;
            }
            
            showSection('retrospectives');
            resetRetrospectiveFlow();
        }

        function resetRetrospectiveFlow() {
            currentStep = 'liked';
            chatHistory = [];
            
            // Reset step cards
            document.querySelectorAll('.step-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelector('[data-step="liked"]').classList.add('active');
            
            // Reset chat
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = `
                <div class="message ai">
                    <div class="message-avatar">ðŸ¤–</div>
                    <div class="message-content">
                        Hi there! Welcome to your retrospective! I'm YodaAI, your AI assistant. Let's start with what you <strong>Liked</strong> about this sprint. What went well that you'd like to continue?
                    </div>
                </div>
            `;
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function sendMessage() {
            if (awaitingResponse) return; // ignore extra sends while waiting

            const input = document.getElementById('chatInput');
            const sendBtn = document.querySelector('.send-btn');
            const message = input.value.trim();

            if (!message) return;

            // Add user message
            addMessageToChat(message, 'user');
            input.value = '';

            // Lock UI while awaiting AI
            awaitingResponse = true;
            input.disabled = true;
            if (sendBtn) sendBtn.disabled = true;

            // Process with AI
            processAIResponse(message);
        }

        function addMessageToChat(message, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const avatar = sender === 'user' ? 'ðŸ‘¤' : 'ðŸ¤–';
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">${message}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function processAIResponse(userMessage) {
            // Try calling backend AI proxy first
            const payload = {
                message: userMessage,
                current_step: currentStep,
                chat_history: chatHistory
            };

            const proxyUrl = '/api/v1/ai-chat/proxy';

            // Optimistic UI: show a typing indicator (create whole message element so we can remove it cleanly)
            const chatMessages = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message ai typing-message';
            typingDiv.innerHTML = `
                <div class="message-avatar">ðŸ¤–</div>
                <div class="message-content"><i class="typing">YodaAI is thinking...</i></div>
            `;
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            fetch(proxyUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            })
            .then(async res => {
                // Remove typing indicator element
                const typingEl = document.querySelector('.typing-message');
                if (typingEl && typingEl.parentNode) typingEl.parentNode.removeChild(typingEl);

                if (!res.ok) throw new Error('AI proxy returned ' + res.status);
                const data = await res.json();
                const aiText = data.response || data.reply || 'Sorry, I had trouble responding.';

                addMessageToChat(aiText, 'ai');

                // save to history
                chatHistory.push({step: currentStep, message: userMessage});

                // Decide whether to move to next step using server guidance or fallback logic
                if (chatHistory.filter(h => h.step === currentStep).length >= 2 && Math.random() > 0.5) {
                    moveToNextStep();
                }

                // release UI lock
                awaitingResponse = false;
                const inputEl = document.getElementById('chatInput');
                const sendBtnEl = document.querySelector('.send-btn');
                if (inputEl) inputEl.disabled = false;
                if (sendBtnEl) sendBtnEl.disabled = false;
            })
            .catch(err => {
                // Remove typing indicator element
                const typingEl = document.querySelector('.typing-message');
                if (typingEl && typingEl.parentNode) typingEl.parentNode.removeChild(typingEl);

                // Fallback to local generator if proxy fails
                console.warn('AI proxy failed, falling back to local generator:', err);
                let aiResponse = '';
                switch(currentStep) {
                    case 'liked':
                        aiResponse = generateLikedResponse(userMessage);
                        break;
                    case 'learned':
                        aiResponse = generateLearnedResponse(userMessage);
                        break;
                    case 'lacked':
                        aiResponse = generateLackedResponse(userMessage);
                        break;
                    case 'longed':
                        aiResponse = generateLongedResponse(userMessage);
                        break;
                }

                addMessageToChat(aiResponse, 'ai');

                chatHistory.push({step: currentStep, message: userMessage});
                if (chatHistory.filter(h => h.step === currentStep).length >= 2 && Math.random() > 0.6) {
                    moveToNextStep();
                }

                // release UI lock on error path as well
                awaitingResponse = false;
                const inputEl = document.getElementById('chatInput');
                const sendBtnEl = document.querySelector('.send-btn');
                if (inputEl) inputEl.disabled = false;
                if (sendBtnEl) sendBtnEl.disabled = false;
            });
        }

        function generateLikedResponse(message) {
            const messageLower = message.toLowerCase();
            
            // Handle casual greetings naturally
            if (messageLower === 'hello' || messageLower === 'hi' || messageLower === 'hey') {
                return "Hi there! Great to see you. Ready to dive into your retrospective? Let's start with what you liked about this sprint - what went well that you'd like to continue?";
            }
            
            if (messageLower.includes('how are you') || messageLower.includes('how are y')) {
                return "I'm doing great, thanks for asking! I'm excited to help you with your retrospective. What did you like about this sprint? What went well that you'd like to continue?";
            }
            
            if (messageLower.includes('fine') || messageLower.includes('good') || messageLower.includes('okay')) {
                return "That's wonderful to hear! Now let's focus on your sprint. What did you like about this sprint? What went well that you'd like to continue?";
            }
            
            // Context-aware responses based on keywords
            if (messageLower.includes('team') || messageLower.includes('collaboration') || messageLower.includes('working together')) {
                return "That's fantastic! Team collaboration is often the foundation of successful sprints. What specific aspects of the teamwork made this particularly effective? Was it the communication, the shared goals, or something else?";
            }
            
            if (messageLower.includes('code') || messageLower.includes('development') || messageLower.includes('programming')) {
                return "Excellent! Technical achievements are always worth celebrating. What made this development work stand out? Was it the quality, the speed, or perhaps the innovative approach?";
            }
            
            if (messageLower.includes('process') || messageLower.includes('workflow') || messageLower.includes('method')) {
                return "Process improvements are crucial for long-term success! What specific changes or approaches made this process work so well? How do you think this could be replicated in future sprints?";
            }
            
            if (messageLower.includes('communication') || messageLower.includes('meeting') || messageLower.includes('discussion')) {
                return "Communication is the backbone of effective agile teams! What made the communication particularly good this sprint? Was it the frequency, the clarity, or the tools used?";
            }
            
            if (messageLower.includes('deadline') || messageLower.includes('delivery') || messageLower.includes('release')) {
                return "Meeting deadlines and delivering value is always satisfying! What factors contributed to this successful delivery? Was it the planning, the execution, or the team coordination?";
            }
            
            // Generic but conversational responses
            const responses = [
                `That's great to hear! "${message}" sounds like a real positive highlight. Can you tell me more about what specifically made this work so well?`,
                `Excellent! I can see this was valuable for the team. When you mention "${message}", what comes to mind as the key elements that made this particularly effective?`,
                `Fantastic! This kind of positive feedback is important for team morale. What about "${message}" made it stand out as something you'd like to continue or build upon?`,
                `That's wonderful! It's important to recognize what's working. When you think about "${message}", what would you say was the most impactful aspect of this success?`
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateLearnedResponse(message) {
            const messageLower = message.toLowerCase();
            
            // Handle casual greetings naturally
            if (messageLower === 'hello' || messageLower === 'hi' || messageLower === 'hey') {
                return "Hi there! Great to see you. Now let's talk about what you learned during this sprint. What new insights or knowledge did you gain?";
            }
            
            if (messageLower.includes('how are you') || messageLower.includes('how are y')) {
                return "I'm doing great, thanks! Now let's focus on your learnings. What did you learn during this sprint? What new insights or knowledge did you gain?";
            }
            
            if (messageLower.includes('fine') || messageLower.includes('good') || messageLower.includes('okay')) {
                return "That's wonderful to hear! Now let's talk about what you learned during this sprint. What new insights or knowledge did you gain?";
            }
            
            
            // Context-aware responses based on keywords
            if (messageLower.includes('technical') || messageLower.includes('technology') || messageLower.includes('tool') || messageLower.includes('framework')) {
                return "Technical learnings are incredibly valuable! What specific aspect of this technology or tool made it particularly insightful? How do you see this knowledge benefiting the team's future work?";
            }
            
            if (messageLower.includes('process') || messageLower.includes('workflow') || messageLower.includes('methodology')) {
                return "Process insights are gold for continuous improvement! What did you discover about the process that you hadn't realized before? How might this change how the team approaches similar situations?";
            }
            
            if (messageLower.includes('team') || messageLower.includes('collaboration') || messageLower.includes('communication')) {
                return "Team dynamics insights are crucial for growth! What did you learn about working with others that surprised you? How do you think this understanding will improve future collaboration?";
            }
            
            if (messageLower.includes('customer') || messageLower.includes('user') || messageLower.includes('feedback')) {
                return "Customer insights are invaluable! What did you learn about user needs or feedback that changed your perspective? How will this influence your approach to future development?";
            }
            
            if (messageLower.includes('project') || messageLower.includes('management') || messageLower.includes('planning')) {
                return "Project management learnings are essential! What did you discover about planning or execution that you'll apply differently next time? What was the most surprising aspect of this learning?";
            }
            
            // Generic but conversational responses
            const responses = [
                `That's a valuable learning! When you say "${message}", what was the most surprising or impactful part of this discovery? How do you think this knowledge will help the team in future sprints?`,
                `Great insight! Learning is one of the most important outcomes of retrospectives. What about "${message}" made it particularly meaningful for you? How might this change your approach going forward?`,
                `Excellent! This kind of learning helps the team grow. What was the context or situation that led to this realization about "${message}"? Are there any other related insights you'd like to share?`,
                `That's wonderful! Learning from experience is crucial. What would you say was the key takeaway from "${message}"? How do you see this benefiting not just you, but the entire team?`
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateLackedResponse(message) {
            const messageLower = message.toLowerCase();
            
            // Handle casual greetings naturally
            if (messageLower === 'hello' || messageLower === 'hi' || messageLower === 'hey') {
                return "Hi there! Now let's discuss what didn't go well. What challenges did you face? What didn't go well that we could improve?";
            }
            
            if (messageLower.includes('how are you') || messageLower.includes('how are y')) {
                return "I'm doing great, thanks! Now let's focus on the challenges. What didn't go well this sprint? What challenges did you face?";
            }
            
            if (messageLower.includes('fine') || messageLower.includes('good') || messageLower.includes('okay')) {
                return "That's wonderful to hear! Now let's discuss what didn't go well. What challenges did you face? What didn't go well that we could improve?";
            }
            
            
            // Context-aware responses based on keywords
            if (messageLower.includes('communication') || messageLower.includes('meeting') || messageLower.includes('discussion')) {
                return "Communication challenges can really impact team effectiveness. What specific aspects of the communication broke down? Was it the frequency, the clarity, the tools, or something else? How do you think this could be improved?";
            }
            
            if (messageLower.includes('deadline') || messageLower.includes('time') || messageLower.includes('schedule') || messageLower.includes('delay')) {
                return "Time management issues are common in agile teams. What factors contributed to the timing challenges? Was it the estimation, the scope, unexpected blockers, or something else? What would you do differently next time?";
            }
            
            if (messageLower.includes('technical') || messageLower.includes('bug') || messageLower.includes('code') || messageLower.includes('quality')) {
                return "Technical challenges can be frustrating but also learning opportunities. What was the root cause of the technical issues? Was it related to architecture, testing, documentation, or something else? How might this be prevented in the future?";
            }
            
            if (messageLower.includes('team') || messageLower.includes('collaboration') || messageLower.includes('coordination')) {
                return "Team coordination issues can really impact productivity. What specific aspects of the teamwork didn't work well? Was it the roles, the processes, the communication, or something else? What changes would you suggest?";
            }
            
            if (messageLower.includes('process') || messageLower.includes('workflow') || messageLower.includes('method')) {
                return "Process issues often reveal opportunities for improvement. What about the current process didn't work as expected? Was it too rigid, too loose, missing steps, or something else? How would you redesign this process?";
            }
            
            // Generic but conversational responses
            const responses = [
                `I understand this was challenging. When you mention "${message}", what was the most frustrating aspect? What do you think could have been done differently to improve this situation?`,
                `That's important feedback. How did "${message}" impact the team's productivity or morale? What steps do you think could prevent this from happening again?`,
                `Thank you for sharing this. What was the root cause of "${message}"? What would you suggest as concrete steps to address this in future sprints?`,
                `I appreciate your honesty. This kind of feedback helps identify improvement opportunities. What about "${message}" do you think needs the most attention? How would you prioritize fixing this?`
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateLongedResponse(message) {
            const messageLower = message.toLowerCase();
            
            // Handle casual greetings naturally
            if (messageLower === 'hello' || messageLower === 'hi' || messageLower === 'hey') {
                return "Hi there! Finally, what do you wish had happened differently? What would you like to see happen differently in future sprints?";
            }
            
            if (messageLower.includes('how are you') || messageLower.includes('how are y')) {
                return "I'm doing great, thanks! Now let's talk about your aspirations. What would you like to see happen differently in future sprints?";
            }
            
            if (messageLower.includes('fine') || messageLower.includes('good') || messageLower.includes('okay')) {
                return "That's wonderful to hear! Now let's talk about what you wish had happened differently. What would you like to see happen differently in future sprints?";
            }
            
            
            // Context-aware responses based on keywords
            if (messageLower.includes('more time') || messageLower.includes('better planning') || messageLower.includes('schedule')) {
                return "Time management is often at the heart of many challenges. What specific changes to planning or scheduling do you think would make the biggest difference? How might the team approach estimation or scope differently?";
            }
            
            if (messageLower.includes('communication') || messageLower.includes('meeting') || messageLower.includes('discussion')) {
                return "Better communication can transform team dynamics! What specific improvements to communication would you like to see? More frequent check-ins, better tools, clearer processes, or something else?";
            }
            
            if (messageLower.includes('tools') || messageLower.includes('technology') || messageLower.includes('automation')) {
                return "Technology can be a game-changer for productivity! What specific tools or technologies do you think would help the team work more effectively? How might automation or better tooling address current pain points?";
            }
            
            if (messageLower.includes('team') || messageLower.includes('collaboration') || messageLower.includes('support')) {
                return "Team dynamics are crucial for success! What changes to team structure, roles, or collaboration would you like to see? How might the team work together more effectively?";
            }
            
            if (messageLower.includes('process') || messageLower.includes('workflow') || messageLower.includes('method')) {
                return "Process improvements can have lasting impact! What specific changes to the current process would you like to implement? How might a redesigned workflow address the challenges you've experienced?";
            }
            
            // Generic but conversational responses
            const responses = [
                `That's a great vision for improvement! When you think about "${message}", what would be the first concrete step towards making this happen? What resources or changes would be needed?`,
                `Excellent suggestion! This could really enhance the team's experience. What would need to change to make "${message}" possible? Who would need to be involved in implementing this?`,
                `That's a wonderful aspiration! What about "${message}" excites you most? How do you think this would impact the team's productivity or morale?`,
                `Great thinking! This kind of forward-looking feedback is valuable. What would you say is the most important aspect of "${message}"? How might we prioritize this among other potential improvements?`
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // -----------------------
        // Action Items Upload JS
        // -----------------------
        const actionFileInput = document.getElementById('actionFileInput');
        const analyzeUploadBtn = document.getElementById('analyzeUploadBtn');
        const actionUploadResult = document.getElementById('actionUploadResult');

        if (actionFileInput) {
            actionFileInput.addEventListener('change', (e) => {
                if (e.target.files && e.target.files.length > 0) {
                    analyzeUploadBtn.disabled = false;
                } else {
                    analyzeUploadBtn.disabled = true;
                }
            });
        }

        function clearActionUpload() {
            if (actionFileInput) actionFileInput.value = '';
            if (analyzeUploadBtn) analyzeUploadBtn.disabled = true;
            if (actionUploadResult) { actionUploadResult.style.display = 'none'; actionUploadResult.innerText = ''; }
        }

        async function analyzeUploadedFile() {
            if (!actionFileInput || !actionFileInput.files || actionFileInput.files.length === 0) {
                alert('Please select a file to upload for analysis.');
                return;
            }

            const file = actionFileInput.files[0];
            const reader = new FileReader();

            reader.onload = async function(evt) {
                const text = evt.target.result;

                // Show working state
                analyzeUploadBtn.disabled = true;
                analyzeUploadBtn.innerText = 'Analyzing...';

                try {
                    const res = await fetch('/api/v1/ai-chat/thematic-analysis', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ text })
                    });

                    if (!res.ok) {
                        const err = await res.text();
                        actionUploadResult.style.display = 'block';
                        actionUploadResult.innerText = 'Analysis failed: ' + err;
                        return;
                    }

                    const data = await res.json();
                    actionUploadResult.style.display = 'block';
                    actionUploadResult.innerText = JSON.stringify(data.analysis, null, 2);
                } catch (e) {
                    actionUploadResult.style.display = 'block';
                    actionUploadResult.innerText = 'Request failed: ' + e.message;
                } finally {
                    analyzeUploadBtn.disabled = false;
                    analyzeUploadBtn.innerText = 'Upload & Analyze';
                }
            };

            reader.onerror = function(e) {
                alert('Failed to read file: ' + e);
            };

            reader.readAsText(file);
        }

        // New: analyzeActionFile for Action Items section
        async function analyzeActionFile() {
            const input = document.getElementById('actionFileOnlyInput');
            const status = document.getElementById('actionAnalysisStatus');
            const container = document.getElementById('groupedThemesContainer');

            if (!input || !input.files || input.files.length === 0) {
                alert('Please select a file to analyze.');
                return;
            }

            const file = input.files[0];
            status.innerText = 'Analyzing...';
            container.innerHTML = '';

            try {
                const form = new FormData();
                form.append('file', file, file.name);
                // include optional form fields if needed
                form.append('session_type', 'retrospective');
                form.append('current_step', 'liked');

                const res = await fetch('/api/v1/ai-chat/thematic-analysis', {
                    method: 'POST',
                    body: form
                });

                if (!res.ok) {
                    const err = await res.text();
                    status.innerText = 'Analysis failed: ' + err;
                    return;
                }

                const data = await res.json();
                status.innerText = 'Analysis complete';
                renderGroupedThemes(data.analysis);
            } catch (e) {
                status.innerText = 'Request failed: ' + e.message;
            }
        }

        function clearActionAnalysis() {
            const input = document.getElementById('actionFileOnlyInput');
            const status = document.getElementById('actionAnalysisStatus');
            const container = document.getElementById('groupedThemesContainer');
            if (input) input.value = '';
            if (status) status.innerText = '';
            if (container) container.innerHTML = '';
        }

        // in-memory editable themes structure
        let currentThemes = [];

        function renderGroupedThemes(analysis) {
            const container = document.getElementById('groupedThemesContainer');
            if (!container) return;

            // analysis.themes expected to be [{theme: 'X', examples: [...]}, ...]
            const themes = analysis.themes || [];
            if (themes.length === 0) {
                container.innerHTML = '<div style="color:#ccc;">No themes were detected.</div>';
                currentThemes = [];
                return;
            }

            // Normalize into array of {name, examples}
            const grouped = {};
            themes.forEach(t => {
                const name = (t.theme || 'Other').trim() || 'Other';
                if (!grouped[name]) grouped[name] = [];
                const ex = t.examples || [];
                grouped[name].push(...ex);
            });

            currentThemes = Object.keys(grouped).map(k => ({ name: k, examples: grouped[k].slice(0, 100) }));

            // render editable UI
            const html = currentThemes.map((th, i) => {
                const examplesHtml = th.examples.map((e, ei) => `
                    <li draggable="true" data-theme="${i}" data-ex="${ei}" style="margin-bottom:8px;color:#ddd; display:flex; gap:8px; align-items:flex-start;">
                        <div style="flex:1">${escapeHtml(e)}</div>
                        <div style="display:flex; gap:6px;">
                            <button class="btn btn-outline" onclick="deleteExample(${i}, ${ei})" title="Delete example" style="padding:4px 8px;">Delete</button>
                        </div>
                    </li>`).join('');

                return `
                    <div class="dashboard-card theme-card" style="margin-bottom:12px; padding:12px;">
                        <div class="drag-handle" title="Drag to reorder">â˜°</div>
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; gap:8px;">
                            <div style="display:flex; align-items:center; gap:8px;">
                                <strong id="theme-title-${i}" class="theme-title" contenteditable="true" onblur="saveInlineTitle(${i}, this)" style="color:white;">${escapeHtml(th.name)}</strong>
                            </div>
                            <div style="display:flex; gap:8px;">
                                <button class="btn btn-outline" onclick="addExample(${i})" title="Add example">+Example</button>
                                <button class="btn btn-outline" onclick="deleteTheme(${i})" title="Delete theme">Delete</button>
                            </div>
                        </div>
                        <ul id="examples-${i}" style="margin:0; padding-left:18px; list-style:decimal;">${examplesHtml}</ul>
                    </div>
                `;
            }).join('');

            // Save / export controls
            container.innerHTML = `
                <div style="display:flex; justify-content:flex-end; gap:8px; margin-bottom:10px;">
                    <button class="btn btn-primary" onclick="exportThemes()">Export JSON</button>
                </div>
                ${html}
            `;
            // attach drag handlers and interactive bindings
            setTimeout(() => enableDragAndDrop(), 0);
            setTimeout(() => enableExampleDrag(), 0);
        }

        // Drag & inline-edit helpers (hover drag handle for reordering; inline-edit for title)
        function enableDragAndDrop() {
            const container = document.getElementById('groupedThemesContainer');
            if (!container) return;
            const cards = container.querySelectorAll('.theme-card');
            cards.forEach((card, i) => {
                card.dataset.index = i;
                card.setAttribute('draggable', 'true');
                card.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', String(i));
                    card.classList.add('dragging');
                });
                card.addEventListener('dragend', () => {
                    card.classList.remove('dragging');
                });
                card.addEventListener('dragover', (e) => {
                    e.preventDefault();
                });
                card.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const from = parseInt(e.dataTransfer.getData('text/plain'), 10);
                    const to = parseInt(card.dataset.index, 10);
                    if (isNaN(from) || isNaN(to) || from === to) return;
                    const item = currentThemes.splice(from, 1)[0];
                    currentThemes.splice(to, 0, item);
                    renderGroupedThemes({ themes: currentThemes.map(t => ({ theme: t.name, examples: t.examples })) });
                });
            });
        }

        function saveInlineTitle(index, el) {
            const val = (el.innerText || '').trim() || 'Other';
            currentThemes[index].name = val;
            renderGroupedThemes({ themes: currentThemes.map(t => ({ theme: t.name, examples: t.examples })) });
        }

        // Example drag-and-drop between theme cards
        function enableExampleDrag() {
            const container = document.getElementById('groupedThemesContainer');
            if (!container) return;
            const items = container.querySelectorAll('li[draggable="true"]');
            items.forEach(item => {
                item.addEventListener('dragstart', (e) => {
                    const ti = item.dataset.theme;
                    const ei = item.dataset.ex;
                    e.dataTransfer.setData('text/example', JSON.stringify({ theme: ti, ex: ei }));
                    item.classList.add('dragging-example');
                });
                item.addEventListener('dragend', () => {
                    item.classList.remove('dragging-example');
                });
            });

            // Make each card accept example drops
            const cards = container.querySelectorAll('.theme-card');
            cards.forEach((card, cardIndex) => {
                card.addEventListener('dragover', (e) => {
                    e.preventDefault();
                });
                card.addEventListener('drop', (e) => {
                    e.preventDefault();
                    try {
                        const raw = e.dataTransfer.getData('text/example');
                        if (!raw) return;
                        const parsed = JSON.parse(raw);
                        const fromTheme = parseInt(parsed.theme, 10);
                        const exIndex = parseInt(parsed.ex, 10);
                        if (isNaN(fromTheme) || isNaN(exIndex)) return;
                        // remove from old
                        const item = currentThemes[fromTheme].examples.splice(exIndex, 1)[0];
                        // insert into target at start
                        currentThemes[cardIndex].examples.unshift(item);
                        renderGroupedThemes({ themes: currentThemes.map(t => ({ theme: t.name, examples: t.examples })) });
                    } catch (err) {
                        // ignore
                    }
                });
            });
        }

        function addExample(index) {
            const txt = prompt('Enter example text');
            if (!txt) return;
            currentThemes[index].examples.unshift(txt);
            renderGroupedThemes({ themes: currentThemes.map(t => ({ theme: t.name, examples: t.examples })) });
        }

        function deleteTheme(index) {
            if (!confirm('Delete this theme and its examples?')) return;
            currentThemes.splice(index, 1);
            renderGroupedThemes({ themes: currentThemes.map(t => ({ theme: t.name, examples: t.examples })) });
        }

        function deleteExample(themeIndex, exIndex) {
            if (!confirm('Delete this example?')) return;
            currentThemes[themeIndex].examples.splice(exIndex, 1);
            renderGroupedThemes({ themes: currentThemes.map(t => ({ theme: t.name, examples: t.examples })) });
        }

        function moveExample(themeIndex, exIndex, selectElem) {
            const targetIndex = parseInt(selectElem.value, 10);
            if (isNaN(targetIndex) || targetIndex === themeIndex) return;
            const item = currentThemes[themeIndex].examples.splice(exIndex, 1)[0];
            currentThemes[targetIndex].examples.unshift(item);
            renderGroupedThemes({ themes: currentThemes.map(t => ({ theme: t.name, examples: t.examples })) });
        }

        function exportThemes() {
            const payload = { themes: currentThemes.map(t => ({ theme: t.name, examples: t.examples })) };
            const w = window.open('', '_blank');
            w.document.write('<pre>' + escapeHtml(JSON.stringify(payload, null, 2)) + '</pre>');
        }

        function escapeHtml(s) {
            return String(s).replace(/[&<>"']/g, function(m) { return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m]; });
        }

        function moveToNextStep() {
            const steps = ['liked', 'learned', 'lacked', 'longed'];
            const currentIndex = steps.indexOf(currentStep);
            
            if (currentIndex < steps.length - 1) {
                currentStep = steps[currentIndex + 1];
                
                // Update step cards
                document.querySelectorAll('.step-card').forEach(card => {
                    card.classList.remove('active');
                });
                document.querySelector(`[data-step="${currentStep}"]`).classList.add('active');
                
                // Add AI message about next step
                const stepMessages = {
                    'learned': "Great! Now let's talk about what you <strong>Learned</strong> during this sprint. What new insights or knowledge did you gain?",
                    'lacked': "Now let's discuss what <strong>Lacked</strong> or didn't go well. What challenges did you face?",
                    'longed': "Finally, what do you <strong>Long For</strong>? What would you like to see happen differently in future sprints?"
                };
                
                if (stepMessages[currentStep]) {
                    setTimeout(() => {
                        addMessageToChat(stepMessages[currentStep], 'ai');
                    }, 500);
                }
            }
        }

        // Close modal when clicking outside
        document.getElementById('loginModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeLoginModal();
            }
        });

        // Initialize app
        console.log('YodaAI Enhanced Application Loaded Successfully!');
    </script>
</body>
</html>
